Ext.grid.GridPanel=Ext.extend(Ext.Panel,{autoExpandColumn:false,autoExpandMax:1000,autoExpandMin:50,columnLines:false,ddText:"{0} selected row{1}",deferRowRender:true,enableColumnHide:true,enableColumnMove:true,enableDragDrop:false,enableHdMenu:true,loadMask:false,minColumnWidth:25,stripeRows:false,trackMouseOver:true,stateEvents:["columnmove","columnresize","sortchange","groupchange"],view:null,bubbleEvents:[],rendered:false,viewReady:false,initComponent:function(){Ext.grid.GridPanel.superclass.initComponent.call(this);if(this.columnLines){this.cls=(this.cls||"")+" x-grid-with-col-lines"}this.autoScroll=false;this.autoWidth=false;if(Ext.isArray(this.columns)){this.colModel=new Ext.grid.ColumnModel(this.columns);delete this.columns}if(this.ds){this.store=this.ds;delete this.ds}if(this.cm){this.colModel=this.cm;delete this.cm}if(this.sm){this.selModel=this.sm;delete this.sm}this.store=Ext.StoreMgr.lookup(this.store);this.addEvents("click","dblclick","contextmenu","mousedown","mouseup","mouseover","mouseout","keypress","keydown","cellmousedown","rowmousedown","headermousedown","groupmousedown","rowbodymousedown","containermousedown","cellclick","celldblclick","rowclick","rowdblclick","headerclick","headerdblclick","groupclick","groupdblclick","containerclick","containerdblclick","rowbodyclick","rowbodydblclick","rowcontextmenu","cellcontextmenu","headercontextmenu","groupcontextmenu","containercontextmenu","rowbodycontextmenu","bodyscroll","columnresize","columnmove","sortchange","groupchange","reconfigure","viewready")},onRender:function(h,f){Ext.grid.GridPanel.superclass.onRender.apply(this,arguments);var g=this.getGridEl();this.el.addClass("x-grid-panel");this.mon(g,{scope:this,mousedown:this.onMouseDown,click:this.onClick,dblclick:this.onDblClick,contextmenu:this.onContextMenu});this.relayEvents(g,["mousedown","mouseup","mouseover","mouseout","keypress","keydown"]);var c=this.getView();c.init(this);c.render();this.getSelectionModel().init(this)},initEvents:function(){Ext.grid.GridPanel.superclass.initEvents.call(this);if(this.loadMask){this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({store:this.store},this.loadMask))}},initStateEvents:function(){Ext.grid.GridPanel.superclass.initStateEvents.call(this);this.mon(this.colModel,"hiddenchange",this.saveState,this,{delay:100})},applyState:function(u){var i=this.colModel,p=u.columns,m=this.store,c,o,n;if(p){for(var s=0,q=p.length;s<q;s++){c=p[s];o=i.getColumnById(c.id);if(o){i.setState(c.id,{hidden:c.hidden,width:c.width});n=i.getIndexById(c.id);if(n!=s){i.moveColumn(n,s)}}}}if(m){c=u.sort;if(c){m[m.remoteSort?"setDefaultSort":"sort"](c.field,c.direction)}c=u.group;if(m.groupBy){if(c){m.groupBy(c)}else{m.clearGrouping()}}}var t=Ext.apply({},u);delete t.columns;delete t.sort;Ext.grid.GridPanel.superclass.applyState.call(this,t)},getState:function(){var j={columns:[]},c=this.store,k,h;for(var l=0,i;(i=this.colModel.config[l]);l++){j.columns[l]={id:i.id,width:i.width};if(i.hidden){j.columns[l].hidden=true}}if(c){k=c.getSortState();if(k){j.sort=k}if(c.getGroupState){h=c.getGroupState();if(h){j.group=h}}}return j},afterRender:function(){Ext.grid.GridPanel.superclass.afterRender.call(this);var b=this.view;this.on("bodyresize",b.layout,b);b.layout(true);if(this.deferRowRender){if(!this.deferRowRenderTask){this.deferRowRenderTask=new Ext.util.DelayedTask(b.afterRender,this.view)}this.deferRowRenderTask.delay(10)}else{b.afterRender()}this.viewReady=true},reconfigure:function(e,d){var f=this.rendered;if(f){if(this.loadMask){this.loadMask.destroy();this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({},{store:e},this.initialConfig.loadMask))}}if(this.view){this.view.initData(e,d)}this.store=e;this.colModel=d;if(f){this.view.refresh(true)}this.fireEvent("reconfigure",this,e,d)},onDestroy:function(){if(this.deferRowRenderTask&&this.deferRowRenderTask.cancel){this.deferRowRenderTask.cancel()}if(this.rendered){Ext.destroy(this.view,this.loadMask)}else{if(this.store&&this.store.autoDestroy){this.store.destroy()}}Ext.destroy(this.colModel,this.selModel);this.store=this.selModel=this.colModel=this.view=this.loadMask=null;Ext.grid.GridPanel.superclass.onDestroy.call(this)},processEvent:function(d,c){this.view.processEvent(d,c)},onClick:function(b){this.processEvent("click",b)},onMouseDown:function(b){this.processEvent("mousedown",b)},onContextMenu:function(c,d){this.processEvent("contextmenu",c)},onDblClick:function(b){this.processEvent("dblclick",b)},walkCells:function(k,s,t,p,l){var m=this.colModel,o=m.getColumnCount(),u=this.store,n=u.getCount(),q=true;if(t<0){if(s<0){k--;q=false}while(k>=0){if(!q){s=o-1}q=false;while(s>=0){if(p.call(l||this,k,s,m)===true){return[k,s]}s--}k--}}else{if(s>=o){k++;q=false}while(k<n){if(!q){s=0}q=false;while(s<o){if(p.call(l||this,k,s,m)===true){return[k,s]}s++}k++}}return null},getGridEl:function(){return this.body},stopEditing:Ext.emptyFn,getSelectionModel:function(){if(!this.selModel){this.selModel=new Ext.grid.RowSelectionModel(this.disableSelection?{selectRow:Ext.emptyFn}:null)}return this.selModel},getStore:function(){return this.store},getColumnModel:function(){return this.colModel},getView:function(){if(!this.view){this.view=new Ext.grid.GridView(this.viewConfig)}return this.view},getDragDropText:function(){var b=this.selModel.getCount();return String.format(this.ddText,b,b==1?"":"s")}});Ext.reg("grid",Ext.grid.GridPanel);Ext.grid.GridView=Ext.extend(Ext.util.Observable,{deferEmptyText:true,scrollOffset:undefined,autoFill:false,forceFit:false,sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",columnsText:"Columns",selectedRowClass:"x-grid3-row-selected",borderWidth:2,tdClass:"x-grid3-cell",hdCls:"x-grid3-hd",markDirty:true,cellSelectorDepth:4,rowSelectorDepth:10,rowBodySelectorDepth:10,cellSelector:"td.x-grid3-cell",rowSelector:"div.x-grid3-row",rowBodySelector:"div.x-grid3-row-body",firstRowCls:"x-grid3-row-first",lastRowCls:"x-grid3-row-last",rowClsRe:/(?:^|\s+)x-grid3-row-(first|last|alt)(?:\s+|$)/g,headerMenuOpenCls:"x-grid3-hd-menu-open",rowOverCls:"x-grid3-row-over",constructor:function(b){Ext.apply(this,b);this.addEvents("beforerowremoved","beforerowsinserted","beforerefresh","rowremoved","rowsinserted","rowupdated","refresh");Ext.grid.GridView.superclass.constructor.call(this)},masterTpl:new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header">','<div class="x-grid3-header-inner">','<div class="x-grid3-header-offset" style="{ostyle}">{header}</div>',"</div>",'<div class="x-clear"></div>',"</div>",'<div class="x-grid3-scroller">','<div class="x-grid3-body" style="{bstyle}">{body}</div>','<a href="#" class="x-grid3-focus" tabIndex="-1"></a>',"</div>","</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>"),headerTpl:new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<thead>",'<tr class="x-grid3-hd-row">{cells}</tr>',"</thead>","</table>"),bodyTpl:new Ext.Template("{rows}"),cellTpl:new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>"),initTemplates:function(){var l=this.templates||{},k,g,i=new Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}",'<img alt="" class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div>","</td>"),h=['<tr class="x-grid3-row-body-tr" style="{bodyStyle}">','<td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on">','<div class="x-grid3-row-body">{body}</div>',"</td>","</tr>"].join(""),j=['<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",this.enableRowBody?h:"","</tbody>","</table>"].join("");Ext.applyIf(l,{hcell:i,cell:this.cellTpl,body:this.bodyTpl,header:this.headerTpl,master:this.masterTpl,row:new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}">'+j+"</div>"),rowInner:new Ext.Template(j)});for(g in l){k=l[g];if(k&&Ext.isFunction(k.compile)&&!k.compiled){k.disableFormats=true;k.compile()}}this.templates=l;this.colRe=new RegExp("x-grid3-td-([^\\s]+)","")},fly:function(b){if(!this._flyweight){this._flyweight=new Ext.Element.Flyweight(document.body)}this._flyweight.dom=b;return this._flyweight},getEditorParent:function(){return this.scroller.dom},initElements:function(){var f=Ext.Element,i=Ext.get(this.grid.getGridEl().dom.firstChild),h=new f(i.child("div.x-grid3-viewport")),j=new f(h.child("div.x-grid3-header")),g=new f(h.child("div.x-grid3-scroller"));if(this.grid.hideHeaders){j.setDisplayed(false)}if(this.forceFit){g.setStyle("overflow-x","hidden")}Ext.apply(this,{el:i,mainWrap:h,scroller:g,mainHd:j,innerHd:j.child("div.x-grid3-header-inner").dom,mainBody:new f(f.fly(g).child("div.x-grid3-body")),focusEl:new f(f.fly(g).child("a")),resizeMarker:new f(i.child("div.x-grid3-resize-marker")),resizeProxy:new f(i.child("div.x-grid3-resize-proxy"))});this.focusEl.swallowEvent("click",true)},getRows:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]},findCell:function(b){if(!b){return false}return this.fly(b).findParent(this.cellSelector,this.cellSelectorDepth)},findCellIndex:function(g,h){var e=this.findCell(g),f;if(e){f=this.fly(e).hasClass(h);if(!h||f){return this.getCellIndex(e)}}return false},getCellIndex:function(c){if(c){var d=c.className.match(this.colRe);if(d&&d[1]){return this.cm.getIndexById(d[1])}}return false},findHeaderCell:function(c){var d=this.findCell(c);return d&&this.fly(d).hasClass(this.hdCls)?d:null},findHeaderIndex:function(b){return this.findCellIndex(b,this.hdCls)},findRow:function(b){if(!b){return false}return this.fly(b).findParent(this.rowSelector,this.rowSelectorDepth)},findRowIndex:function(d){var c=this.findRow(d);return c?c.rowIndex:false},findRowBody:function(b){if(!b){return false}return this.fly(b).findParent(this.rowBodySelector,this.rowBodySelectorDepth)},getRow:function(b){return this.getRows()[b]},getCell:function(c,d){return Ext.fly(this.getRow(c)).query(this.cellSelector)[d]},getHeaderCell:function(b){return this.mainHd.dom.getElementsByTagName("td")[b]},addRowClass:function(d,e){var f=this.getRow(d);if(f){this.fly(f).addClass(e)}},removeRowClass:function(f,e){var d=this.getRow(f);if(d){this.fly(d).removeClass(e)}},removeRow:function(b){Ext.removeNode(this.getRow(b));this.syncFocusEl(b)},removeRows:function(h,f){var e=this.mainBody.dom,g;for(g=h;g<=f;g++){Ext.removeNode(e.childNodes[h])}this.syncFocusEl(h)},getScrollState:function(){var b=this.scroller.dom;return{left:b.scrollLeft,top:b.scrollTop}},restoreScroll:function(d){var c=this.scroller.dom;c.scrollLeft=d.left;c.scrollTop=d.top},scrollToTop:function(){var b=this.scroller.dom;b.scrollTop=0;b.scrollLeft=0},syncScroll:function(){this.syncHeaderScroll();var b=this.scroller.dom;this.grid.fireEvent("bodyscroll",b.scrollLeft,b.scrollTop)},syncHeaderScroll:function(){var d=this.innerHd,c=this.scroller.dom.scrollLeft;d.scrollLeft=c;d.scrollLeft=c},updateSortIcon:function(i,j){var g=this.sortClasses,f=g[j=="DESC"?1:0],h=this.mainHd.select("td").removeClass(g);h.item(i).addClass(f)},updateAllColumnWidths:function(){var p=this.getTotalWidth(),m=this.cm.getColumnCount(),i=this.getRows(),o=i.length,t=[],j,u,n,q,s;for(q=0;q<m;q++){t[q]=this.getColumnWidth(q);this.getHeaderCell(q).style.width=t[q]}this.updateHeaderWidth();for(q=0;q<o;q++){j=i[q];j.style.width=p;u=j.firstChild;if(u){u.style.width=p;n=u.rows[0];for(s=0;s<m;s++){n.childNodes[s].style.width=t[s]}}}this.onAllColumnWidthsUpdated(t,p)},updateColumnWidth:function(q,t){var s=this.getColumnWidth(q),m=this.getTotalWidth(),n=this.getHeaderCell(q),u=this.getRows(),p=u.length,i,o,l;this.updateHeaderWidth();n.style.width=s;for(o=0;o<p;o++){i=u[o];l=i.firstChild;i.style.width=m;if(l){l.style.width=m;l.rows[0].childNodes[q].style.width=s}}this.onColumnWidthUpdated(q,s,m)},updateColumnHidden:function(t,m){var n=this.getTotalWidth(),l=m?"none":"",o=this.getHeaderCell(t),u=this.getRows(),q=u.length,i,s,p;this.updateHeaderWidth();o.style.display=l;for(p=0;p<q;p++){i=u[p];i.style.width=n;s=i.firstChild;if(s){s.style.width=n;s.rows[0].childNodes[t].style.display=l}}this.onColumnHiddenUpdated(t,m,n);delete this.lastViewWidth;this.layout()},doRender:function(P,A,J,S,E,C){var M=this.templates,Q=M.cell,i=M.row,H=E-1,R="width:"+this.getTotalWidth()+";",L=[],K=[],I={tstyle:R},F={},z=A.length,j,N,O,B,D,G;for(D=0;D<z;D++){O=A[D];K=[];G=D+S;for(B=0;B<E;B++){N=P[B];F.id=N.id;F.css=B===0?"x-grid3-cell-first ":(B==H?"x-grid3-cell-last ":"");F.attr=F.cellAttr="";F.style=N.style;F.value=N.renderer.call(N.scope,O.data[N.name],F,O,G,B,J);if(Ext.isEmpty(F.value)){F.value="&#160;"}if(this.markDirty&&O.dirty&&typeof O.modified[N.name]!="undefined"){F.css+=" x-grid3-dirty-cell"}K[K.length]=Q.apply(F)}j=[];if(C&&((G+1)%2===0)){j[0]="x-grid3-row-alt"}if(O.dirty){j[1]=" x-grid3-dirty-row"}I.cols=E;if(this.getRowClass){j[2]=this.getRowClass(O,G,I,J)}I.alt=j.join(" ");I.cells=K.join("");L[L.length]=i.apply(I)}return L.join("")},processRows:function(h,i){if(!this.ds||this.ds.getCount()<1){return}var k=this.getRows(),l=k.length,j,g;i=i||!this.grid.stripeRows;h=h||0;for(g=0;g<l;g++){j=k[g];if(j){j.rowIndex=g;if(!i){j.className=j.className.replace(this.rowClsRe," ");if((g+1)%2===0){j.className+=" x-grid3-row-alt"}}}}if(h===0){Ext.fly(k[0]).addClass(this.firstRowCls)}Ext.fly(k[l-1]).addClass(this.lastRowCls)},afterRender:function(){if(!this.ds||!this.cm){return}this.mainBody.dom.innerHTML=this.renderBody()||"&#160;";this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText()}this.grid.fireEvent("viewready",this.grid)},afterRenderUI:function(){var b=this.grid;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(b.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(b,this.mainHd.dom)}if(b.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(b,this.innerHd);this.columnDrop=new Ext.grid.HeaderDropZone(b,this.mainHd.dom)}if(b.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:b.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});if(b.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:b.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(b.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(b.enableDragDrop||b.enableDrag){this.dragZone=new Ext.grid.GridDragZone(b,{ddGroup:b.ddGroup||"GridDD"})}this.updateHeaderSortState()},renderUI:function(){var b=this.templates;return b.master.apply({body:b.body.apply({rows:"&#160;"}),header:this.renderHeaders(),ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";"})},processEvent:function(q,m){var l=m.getTarget(),s=this.grid,o=this.findHeaderIndex(l),e,k,p,n;s.fireEvent(q,m);if(o!==false){s.fireEvent("header"+q,s,o,m)}else{e=this.findRowIndex(l);if(e!==false){k=this.findCellIndex(l);if(k!==false){p=s.colModel.getColumnAt(k);if(s.fireEvent("cell"+q,s,e,k,m)!==false){if(!p||(p.processEvent&&(p.processEvent(q,m,s,e,k)!==false))){s.fireEvent("row"+q,s,e,m)}}}else{if(s.fireEvent("row"+q,s,e,m)!==false){(n=this.findRowBody(l))&&s.fireEvent("rowbody"+q,s,e,m)}}}else{s.fireEvent("container"+q,s,m)}}},layout:function(l){if(!this.mainBody){return}var u=this.grid,q=u.getGridEl(),s=q.getSize(true),m=s.width,t=s.height,n=this.scroller,o,p,k;if(m<20||t<20){return}if(u.autoHeight){o=n.dom.style;o.overflow="visible";if(Ext.isWebKit){o.position="static"}}else{this.el.setSize(m,t);p=this.mainHd.getHeight();k=t-p;n.setSize(m,k);if(this.innerHd){this.innerHd.style.width=(m)+"px"}}if(this.forceFit||(l===true&&this.autoFill)){if(this.lastViewWidth!=m){this.fitColumns(false,false);this.lastViewWidth=m}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(m,k)},onLayout:function(d,c){},onColumnWidthUpdated:function(f,e,d){},onAllColumnWidthsUpdated:function(d,c){},onColumnHiddenUpdated:function(d,f,e){},updateColumnText:function(d,c){},afterMove:function(b){},init:function(b){this.grid=b;this.initTemplates();this.initData(b.store,b.colModel);this.initUI(b)},getColumnId:function(b){return this.cm.getColumnId(b)},getOffsetWidth:function(){return(this.cm.getTotalWidth()+this.getScrollOffset())+"px"},getScrollOffset:function(){return Ext.num(this.scrollOffset,Ext.getScrollBarWidth())},renderHeaders:function(){var n=this.cm,m=this.templates,s=m.hcell,o={},l=n.getColumnCount(),k=l-1,i=[],p,q;for(p=0;p<l;p++){if(p==0){q="x-grid3-cell-first "}else{q=p==k?"x-grid3-cell-last ":""}o={id:n.getColumnId(p),value:n.getColumnHeader(p)||"",style:this.getColumnStyle(p,true),css:q,tooltip:this.getColumnTooltip(p)};if(n.config[p].align=="right"){o.istyle="padding-right: 16px;"}else{delete o.istyle}i[p]=s.apply(o)}return m.header.apply({cells:i.join(""),tstyle:String.format("width: {0};",this.getTotalWidth())})},getColumnTooltip:function(d){var c=this.cm.getColumnTooltip(d);if(c){if(Ext.QuickTips.isEnabled()){return'ext:qtip="'+c+'"'}else{return'title="'+c+'"'}}return""},beforeUpdate:function(){this.grid.stopEditing(true)},updateHeaders:function(){this.innerHd.firstChild.innerHTML=this.renderHeaders();this.updateHeaderWidth(false)},updateHeaderWidth:function(f){var d=this.innerHd.firstChild,e=this.getTotalWidth();d.style.width=this.getOffsetWidth();d.firstChild.style.width=e;if(f!==false){this.mainBody.dom.style.width=e}},focusRow:function(b){this.focusCell(b,0,false)},focusCell:function(g,e,h){this.syncFocusEl(this.ensureVisible(g,e,h));var f=this.focusEl;if(Ext.isGecko){f.focus()}else{f.focus.defer(1,f)}},resolveCell:function(j,m,k){if(!Ext.isNumber(j)){j=j.rowIndex}if(!this.ds){return null}if(j<0||j>=this.ds.getCount()){return null}m=(m!==undefined?m:0);var n=this.getRow(j),h=this.cm,l=h.getColumnCount(),i;if(!(k===false&&m===0)){while(m<l&&h.isHidden(m)){m++}i=this.getCell(j,m)}return{row:n,cell:i}},getResolvedXY:function(d){if(!d){return null}var e=d.cell,f=d.row;if(e){return Ext.fly(e).getXY()}else{return[this.el.getX(),Ext.fly(f).getY()]}},syncFocusEl:function(g,f,h){var e=g;if(!Ext.isArray(e)){g=Math.min(g,Math.max(0,this.getRows().length-1));if(isNaN(g)){return}e=this.getResolvedXY(this.resolveCell(g,f,h))}this.focusEl.setXY(e||this.scroller.getXY())},ensureVisible:function(H,C,D){var c=this.resolveCell(H,C,D);if(!c||!c.row){return null}var y=c.row,B=c.cell,v=this.scroller.dom,E=y,I=0,u=this.el.dom;while(E&&E!=u){I+=E.offsetTop;E=E.offsetParent}I-=this.mainHd.dom.offsetHeight;u=parseInt(v.scrollTop,10);var p=I+y.offsetHeight,G=v.clientHeight,w=u+G;if(I<u){v.scrollTop=I}else{if(p>w){v.scrollTop=p-G}}if(D!==false){var x=parseInt(B.offsetLeft,10),z=x+B.offsetWidth,A=parseInt(v.scrollLeft,10),F=A+v.clientWidth;if(x<A){v.scrollLeft=x}else{if(z>F){v.scrollLeft=z-v.clientWidth}}}return this.getResolvedXY(c)},insertRows:function(j,k,n,l){var o=j.getCount()-1;if(!l&&k===0&&n>=o){this.fireEvent("beforerowsinserted",this,k,n);this.refresh();this.fireEvent("rowsinserted",this,k,n)}else{if(!l){this.fireEvent("beforerowsinserted",this,k,n)}var i=this.renderRows(k,n),m=this.getRow(k);if(m){if(k===0){Ext.fly(this.getRow(0)).removeClass(this.firstRowCls)}Ext.DomHelper.insertHtml("beforeBegin",m,i)}else{var p=this.getRow(o-1);if(p){Ext.fly(p).removeClass(this.lastRowCls)}Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,i)}if(!l){this.fireEvent("rowsinserted",this,k,n);this.processRows(k)}else{if(k===0||k>=o){Ext.fly(this.getRow(k)).addClass(k===0?this.firstRowCls:this.lastRowCls)}}}this.syncFocusEl(k)},deleteRows:function(e,f,d){if(e.getRowCount()<1){this.refresh()}else{this.fireEvent("beforerowsdeleted",this,f,d);this.removeRows(f,d);this.processRows(f);this.fireEvent("rowsdeleted",this,f,d)}},getColumnStyle:function(g,k){var h=this.cm,i=h.config,l=k?"":i[g].css||"",j=i[g].align;l+=String.format("width: {0};",this.getColumnWidth(g));if(h.isHidden(g)){l+="display: none; "}if(j){l+=String.format("text-align: {0};",j)}return l},getColumnWidth:function(d){var f=this.cm.getColumnWidth(d),e=this.borderWidth;if(Ext.isNumber(f)){if(Ext.isBorderBox||(Ext.isWebKit&&!Ext.isSafari2)){return f+"px"}else{return Math.max(f-e,0)+"px"}}else{return f}},getTotalWidth:function(){return this.cm.getTotalWidth()+"px"},fitColumns:function(H,F,G){var M=this.grid,D=this.cm,w=D.getTotalWidth(false),y=this.getGridInnerWidth(),x=y-w,K=[],A=0,B=0,i,J,z;if(y<20||x===0){return false}var I=D.getColumnCount(true),C=D.getColumnCount(false),L=I-(Ext.isNumber(G)?1:0);if(L===0){L=1;G=undefined}for(z=0;z<C;z++){if(!D.isFixed(z)&&z!==G){i=D.getColumnWidth(z);K.push(z,i);if(!D.isHidden(z)){A=z;B+=i}}}J=(y-D.getTotalWidth())/B;while(K.length){i=K.pop();z=K.pop();D.setColumnWidth(z,Math.max(M.minColumnWidth,Math.floor(i+i*J)),true)}w=D.getTotalWidth(false);if(w>y){var v=(L==I)?A:G,E=Math.max(1,D.getColumnWidth(v)-(w-y));D.setColumnWidth(v,E,true)}if(H!==true){this.updateAllColumnWidths()}return true},autoExpand:function(k){var u=this.grid,m=this.cm,p=this.getGridInnerWidth(),s=m.getTotalWidth(false),o=u.autoExpandColumn;if(!this.userResized&&o){if(p!=s){var l=m.getIndexById(o),t=m.getColumnWidth(l),n=p-s+t,q=Math.min(Math.max(n,u.autoExpandMin),u.autoExpandMax);if(t!=q){m.setColumnWidth(l,q,true);if(k!==true){this.updateColumnWidth(l,q)}}}}},getGridInnerWidth:function(){return this.grid.getGridEl().getWidth(true)-this.getScrollOffset()},getColumnData:function(){var j=[],l=this.cm,i=l.getColumnCount(),h=this.ds.fields,k,g;for(k=0;k<i;k++){g=l.getDataIndex(k);j[k]={name:Ext.isDefined(g)?g:(h.get(k)?h.get(k).name:undefined),renderer:l.getRenderer(k),scope:l.getRendererScope(k),id:l.getColumnId(k),style:this.getColumnStyle(k)}}return j},renderRows:function(k,p){var s=this.grid,m=s.store,j=s.stripeRows,n=s.colModel,l=n.getColumnCount(),o=m.getCount(),q;if(o<1){return""}k=k||0;p=Ext.isDefined(p)?p:o-1;q=m.getRange(k,p);return this.doRender(this.getColumnData(),q,m,k,l,j)},renderBody:function(){var b=this.renderRows()||"&#160;";return this.templates.body.apply({rows:b})},refreshRow:function(z){var v=this.ds,u=this.cm.getColumnCount(),C=this.getColumnData(),t=u-1,q=["x-grid3-row"],A={tstyle:String.format("width: {0};",this.getTotalWidth())},E=[],w=this.templates.cell,x,i,D,s,y,B;if(Ext.isNumber(z)){x=z;z=v.getAt(x)}else{x=v.indexOf(z)}if(!z||x<0){return}for(B=0;B<u;B++){D=C[B];if(B==0){y="x-grid3-cell-first"}else{y=(B==t)?"x-grid3-cell-last ":""}s={id:D.id,style:D.style,css:y,attr:"",cellAttr:""};s.value=D.renderer.call(D.scope,z.data[D.name],s,z,x,B,v);if(Ext.isEmpty(s.value)){s.value="&#160;"}if(this.markDirty&&z.dirty&&typeof z.modified[D.name]!="undefined"){s.css+=" x-grid3-dirty-cell"}E[B]=w.apply(s)}i=this.getRow(x);i.className="";if(this.grid.stripeRows&&((x+1)%2===0)){q.push("x-grid3-row-alt")}if(this.getRowClass){A.cols=u;q.push(this.getRowClass(z,x,A,v))}this.fly(i).addClass(q).setStyle(A.tstyle);A.cells=E.join("");i.innerHTML=this.templates.rowInner.apply(A);this.fireEvent("rowupdated",this,x,z)},refresh:function(c){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var d=this.renderBody();this.mainBody.update(d).setWidth(this.getTotalWidth());if(c===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},applyEmptyText:function(){if(this.emptyText&&!this.hasRows()){this.mainBody.update('<div class="x-grid-empty">'+this.emptyText+"</div>")}},updateHeaderSortState:function(){var d=this.ds.getSortState();if(!d){return}if(!this.sortState||(this.sortState.field!=d.field||this.sortState.direction!=d.direction)){this.grid.fireEvent("sortchange",this.grid,d)}this.sortState=d;var f=this.cm.findColumnIndex(d.field);if(f!=-1){var e=d.direction;this.updateSortIcon(f,e)}},clearHeaderSortState:function(){if(!this.sortState){return}this.grid.fireEvent("sortchange",this.grid,null);this.mainHd.select("td").removeClass(this.sortClasses);delete this.sortState},destroy:function(){var l=this,u=l.grid,q=u.getGridEl(),m=l.dragZone,o=l.splitZone,n=l.columnDrag,p=l.columnDrop,k=l.scrollToTopTask,s,t;if(k&&k.cancel){k.cancel()}Ext.destroyMembers(l,"colMenu","hmenu");l.initData(null,null);l.purgeListeners();Ext.fly(l.innerHd).un("click",l.handleHdDown,l);if(u.enableColumnMove){s=n.dragData;t=n.proxy;Ext.destroy(n.el,t.ghost,t.el,p.el,p.proxyTop,p.proxyBottom,s.ddel,s.header);if(t.anim){Ext.destroy(t.anim)}delete t.ghost;delete s.ddel;delete s.header;n.destroy();delete Ext.dd.DDM.locationCache[n.id];delete n._domRef;delete p.proxyTop;delete p.proxyBottom;p.destroy();delete Ext.dd.DDM.locationCache["gridHeader"+q.id];delete p._domRef;delete Ext.dd.DDM.ids[p.ddGroup]}if(o){o.destroy();delete o._domRef;delete Ext.dd.DDM.ids["gridSplitters"+q.id]}Ext.fly(l.innerHd).removeAllListeners();Ext.removeNode(l.innerHd);delete l.innerHd;Ext.destroy(l.el,l.mainWrap,l.mainHd,l.scroller,l.mainBody,l.focusEl,l.resizeMarker,l.resizeProxy,l.activeHdBtn,l._flyweight,m,o);delete u.container;if(m){m.destroy()}Ext.dd.DDM.currentTarget=null;delete Ext.dd.DDM.locationCache[q.id];Ext.EventManager.removeResizeListener(l.onWindowResize,l)},onDenyColumnHide:function(){},render:function(){if(this.autoFill){var b=this.grid.ownerCt;if(b&&b.getLayout()){b.on("afterlayout",function(){this.fitColumns(true,true);this.updateHeaders();this.updateHeaderSortState()},this,{single:true})}}else{if(this.forceFit){this.fitColumns(true,false)}else{if(this.grid.autoExpandColumn){this.autoExpand(true)}}}this.grid.getGridEl().dom.innerHTML=this.renderUI();this.afterRenderUI()},initData:function(g,h){var f=this;if(f.ds){var i=f.ds;i.un("add",f.onAdd,f);i.un("load",f.onLoad,f);i.un("clear",f.onClear,f);i.un("remove",f.onRemove,f);i.un("update",f.onUpdate,f);i.un("datachanged",f.onDataChange,f);if(i!==g&&i.autoDestroy){i.destroy()}}if(g){g.on({scope:f,load:f.onLoad,add:f.onAdd,remove:f.onRemove,update:f.onUpdate,clear:f.onClear,datachanged:f.onDataChange})}if(f.cm){var j=f.cm;j.un("configchange",f.onColConfigChange,f);j.un("widthchange",f.onColWidthChange,f);j.un("headerchange",f.onHeaderChange,f);j.un("hiddenchange",f.onHiddenChange,f);j.un("columnmoved",f.onColumnMove,f)}if(h){delete f.lastViewWidth;h.on({scope:f,configchange:f.onColConfigChange,widthchange:f.onColWidthChange,headerchange:f.onHeaderChange,hiddenchange:f.onHiddenChange,columnmoved:f.onColumnMove})}f.ds=g;f.cm=h},onDataChange:function(){this.refresh(true);this.updateHeaderSortState();this.syncFocusEl(0)},onClear:function(){this.refresh();this.syncFocusEl(0)},onUpdate:function(c,d){this.refreshRow(d)},onAdd:function(d,e,f){this.insertRows(d,f,f+(e.length-1))},onRemove:function(e,f,h,g){if(g!==true){this.fireEvent("beforerowremoved",this,h,f)}this.removeRow(h);if(g!==true){this.processRows(h);this.applyEmptyText();this.fireEvent("rowremoved",this,h,f)}},onLoad:function(){if(Ext.isGecko){if(!this.scrollToTopTask){this.scrollToTopTask=new Ext.util.DelayedTask(this.scrollToTop,this)}this.scrollToTopTask.delay(1)}else{this.scrollToTop()}},onColWidthChange:function(e,d,f){this.updateColumnWidth(d,f)},onHeaderChange:function(e,d,f){this.updateHeaders()},onHiddenChange:function(e,d,f){this.updateColumnHidden(d,f)},onColumnMove:function(e,f,d){this.indexMap=null;this.refresh(true);this.restoreScroll(this.getScrollState());this.afterMove(d);this.grid.fireEvent("columnmove",f,d)},onColConfigChange:function(){delete this.lastViewWidth;this.indexMap=null;this.refresh(true)},initUI:function(b){b.on("headerclick",this.onHeaderClick,this)},initEvents:Ext.emptyFn,onHeaderClick:function(c,d){if(this.headersDisabled||!this.cm.isSortable(d)){return}c.stopEditing(true);c.store.sort(this.cm.getDataIndex(d))},onRowOver:function(d,e){var f=this.findRowIndex(e);if(f!==false){this.addRowClass(f,this.rowOverCls)}},onRowOut:function(d,e){var f=this.findRowIndex(e);if(f!==false&&!d.within(this.getRow(f),true)){this.removeRowClass(f,this.rowOverCls)}},onRowSelect:function(b){this.addRowClass(b,this.selectedRowClass)},onRowDeselect:function(b){this.removeRowClass(b,this.selectedRowClass)},onCellSelect:function(f,d){var e=this.getCell(f,d);if(e){this.fly(e).addClass("x-grid3-cell-selected")}},onCellDeselect:function(f,d){var e=this.getCell(f,d);if(e){this.fly(e).removeClass("x-grid3-cell-selected")}},handleWheel:function(b){b.stopPropagation()},onColumnSplitterMoved:function(d,c){this.userResized=true;this.grid.colModel.setColumnWidth(d,c,true);if(this.forceFit){this.fitColumns(true,false,d);this.updateAllColumnWidths()}else{this.updateColumnWidth(d,c);this.syncHeaderScroll()}this.grid.fireEvent("columnresize",d,c)},beforeColMenuShow:function(){var e=this.cm,g=e.getColumnCount(),f=this.colMenu,h;f.removeAll();for(h=0;h<g;h++){if(e.config[h].hideable!==false){f.add(new Ext.menu.CheckItem({text:e.getColumnHeader(h),itemId:"col-"+e.getColumnId(h),checked:!e.isHidden(h),disabled:e.config[h].hideable===false,hideOnClick:false}))}}},handleHdMenuClick:function(f){var e=this.ds,d=this.cm.getDataIndex(this.hdCtxIndex);switch(f.getItemId()){case"asc":e.sort(d,"ASC");break;case"desc":e.sort(d,"DESC");break;default:this.handleHdMenuClickDefault(f)}return true},handleHdMenuClickDefault:function(h){var e=this.cm,g=h.getItemId(),f=e.getIndexById(g.substr(4));if(f!=-1){if(h.checked&&e.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();return}e.setHidden(f,h.checked)}},handleHdDown:function(l,k){if(Ext.fly(k).hasClass("x-grid3-hd-btn")){l.stopEvent();var e=this.cm,n=this.findHeaderCell(k),m=this.getCellIndex(n),o=e.isSortable(m),p=this.hmenu,q=p.items,s=this.headerMenuOpenCls;this.hdCtxIndex=m;Ext.fly(n).addClass(s);q.get("asc").setDisabled(!o);q.get("desc").setDisabled(!o);p.on("hide",function(){Ext.fly(n).removeClass(s)},this,{single:true});p.show(k,"tl-bl?")}},handleHdMove:function(u){var w=this.findHeaderCell(this.activeHdRef);if(w&&!this.headersDisabled){var t=this.splitHandleWidth||5,v=this.activeHdRegion,e=w.style,s=this.cm,p="",y=u.getPageX();if(this.grid.enableColumnResize!==false){var C=this.activeHdIndex,B=this.getPreviousVisible(C),q=s.isResizable(C),A=B&&s.isResizable(B),z=y-v.left<=t,x=v.right-y<=(!this.activeHdBtn?t:2);if(z&&A){p=Ext.isAir?"move":Ext.isWebKit?"e-resize":"col-resize"}else{if(x&&q){p=Ext.isAir?"move":Ext.isWebKit?"w-resize":"col-resize"}}}e.cursor=p}},getPreviousVisible:function(b){while(b>0){if(!this.cm.isHidden(b-1)){return b}b--}return undefined},handleHdOver:function(h,e){var g=this.findHeaderCell(e);if(g&&!this.headersDisabled){var f=this.fly(g);this.activeHdRef=e;this.activeHdIndex=this.getCellIndex(g);this.activeHdRegion=f.getRegion();if(!this.isMenuDisabled(this.activeHdIndex,f)){f.addClass("x-grid3-hd-over");this.activeHdBtn=f.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(g.firstChild.offsetHeight-1)+"px"}}}},handleHdOut:function(d,e){var f=this.findHeaderCell(e);if(f&&(!Ext.isIE||!d.within(f,true))){this.activeHdRef=null;this.fly(f).removeClass("x-grid3-hd-over");f.style.cursor=""}},isMenuDisabled:function(d,c){return this.cm.isMenuDisabled(d)},hasRows:function(){var b=this.mainBody.dom.firstChild;return b&&b.nodeType==1&&b.className!="x-grid-empty"},isHideableColumn:function(b){return !b.hidden},bind:function(d,c){this.initData(d,c)}});Ext.grid.GridView.SplitDragZone=Ext.extend(Ext.dd.DDProxy,{constructor:function(d,c){this.grid=d;this.view=d.getView();this.marker=this.view.resizeMarker;this.proxy=this.view.resizeProxy;Ext.grid.GridView.SplitDragZone.superclass.constructor.call(this,c,"gridSplitters"+this.grid.getGridEl().id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.scroll=false;this.hw=this.view.splitHandleWidth||5},b4StartDrag:function(g,h){this.dragHeadersDisabled=this.view.headersDisabled;this.view.headersDisabled=true;var i=this.view.mainWrap.getHeight();this.marker.setHeight(i);this.marker.show();this.marker.alignTo(this.view.getHeaderCell(this.cellIndex),"tl-tl",[-2,0]);this.proxy.setHeight(i);var f=this.cm.getColumnWidth(this.cellIndex),j=Math.max(f-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(j,1000);this.setYConstraint(0,0);this.minX=g-j;this.maxX=g+1000;this.startPos=g;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,g,h)},allowHeaderDrag:function(b){return true},handleMouseDown:function(s){var m=this.view.findHeaderCell(s.getTarget());if(m&&this.allowHeaderDrag(s)){var e=this.view.fly(m).getXY(),p=e[0],l=s.getXY(),q=l[0],n=m.offsetWidth,o=false;if((q-p)<=this.hw){o=-1}else{if((p+n)-q<=this.hw){o=0}}if(o!==false){this.cm=this.grid.colModel;var k=this.view.getCellIndex(m);if(o==-1){if(k+o<0){return}while(this.cm.isHidden(k+o)){--o;if(k+o<0){return}}}this.cellIndex=k+o;this.split=m.dom;if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){Ext.grid.GridView.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)}}else{if(this.view.columnDrag){this.view.columnDrag.callHandleMouseDown(s)}}}},endDrag:function(h){this.marker.hide();var g=this.view,j=Math.max(this.minX,h.getPageX()),i=j-this.startPos,e=this.dragHeadersDisabled;g.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+i);setTimeout(function(){g.headersDisabled=e},50)},autoOffset:function(){this.setDelta(0,0)}});Ext.grid.HeaderDragZone=Ext.extend(Ext.dd.DragZone,{maxDragWidth:120,constructor:function(e,f,d){this.grid=e;this.view=e.getView();this.ddGroup="gridHeader"+this.grid.getGridEl().id;Ext.grid.HeaderDragZone.superclass.constructor.call(this,f);if(d){this.setHandleElId(Ext.id(f));this.setOuterHandleElId(Ext.id(d))}this.scroll=false},getDragData:function(f){var e=Ext.lib.Event.getTarget(f),d=this.view.findHeaderCell(e);if(d){return{ddel:d.firstChild,header:d}}return false},onInitDrag:function(d){this.dragHeadersDisabled=this.view.headersDisabled;this.view.headersDisabled=true;var c=this.dragData.ddel.cloneNode(true);c.id=Ext.id();c.style.width=Math.min(this.dragData.header.offsetWidth,this.maxDragWidth)+"px";this.proxy.update(c);return true},afterValidDrop:function(){this.completeDrop()},afterInvalidDrop:function(){this.completeDrop()},completeDrop:function(){var d=this.view,c=this.dragHeadersDisabled;setTimeout(function(){d.headersDisabled=c},50)}});Ext.grid.HeaderDropZone=Ext.extend(Ext.dd.DropZone,{proxyOffsets:[-4,-9],fly:Ext.Element.fly,constructor:function(e,f,d){this.grid=e;this.view=e.getView();this.proxyTop=Ext.DomHelper.append(document.body,{cls:"col-move-top",html:"&#160;"},true);this.proxyBottom=Ext.DomHelper.append(document.body,{cls:"col-move-bottom",html:"&#160;"},true);this.proxyTop.hide=this.proxyBottom.hide=function(){this.setLeftTop(-100,-100);this.setStyle("visibility","hidden")};this.ddGroup="gridHeader"+this.grid.getGridEl().id;Ext.grid.HeaderDropZone.superclass.constructor.call(this,e.getGridEl().dom)},getTargetFromEvent:function(f){var e=Ext.lib.Event.getTarget(f),d=this.view.findCellIndex(e);if(d!==false){return this.view.getHeaderCell(d)}},nextVisible:function(f){var d=this.view,e=this.grid.colModel;f=f.nextSibling;while(f){if(!e.isHidden(d.getCellIndex(f))){return f}f=f.nextSibling}return null},prevVisible:function(f){var d=this.view,e=this.grid.colModel;f=f.prevSibling;while(f){if(!e.isHidden(d.getCellIndex(f))){return f}f=f.prevSibling}return null},positionIndicator:function(o,k,l){var h=Ext.lib.Event.getPageX(l),n=Ext.lib.Dom.getRegion(k.firstChild),p,m,e=n.top+this.proxyOffsets[1];if((n.right-h)<=(n.right-n.left)/2){p=n.right+this.view.borderWidth;m="after"}else{p=n.left;m="before"}if(this.grid.colModel.isFixed(this.view.getCellIndex(k))){return false}p+=this.proxyOffsets[0];this.proxyTop.setLeftTop(p,e);this.proxyTop.show();if(!this.bottomOffset){this.bottomOffset=this.view.mainHd.getHeight()}this.proxyBottom.setLeftTop(p,e+this.proxyTop.dom.offsetHeight+this.bottomOffset);this.proxyBottom.show();return m},onNodeEnter:function(g,f,h,e){if(e.header!=g){this.positionIndicator(e.header,g,h)}},onNodeOver:function(h,e,i,j){var g=false;if(j.header!=h){g=this.positionIndicator(j.header,h,i)}if(!g){this.proxyTop.hide();this.proxyBottom.hide()}return g?this.dropAllowed:this.dropNotAllowed},onNodeOut:function(g,f,h,e){this.proxyTop.hide();this.proxyBottom.hide()},onNodeDrop:function(v,h,s,u){var t=u.header;if(t!=v){var o=this.grid.colModel,p=Ext.lib.Event.getPageX(s),w=Ext.lib.Dom.getRegion(v.firstChild),e=(w.right-p)<=((w.right-w.left)/2)?"after":"before",q=this.view.getCellIndex(t),n=this.view.getCellIndex(v);if(e=="after"){n++}if(q<n){n--}o.moveColumn(q,n);return true}return false}});Ext.grid.GridView.ColumnDragZone=Ext.extend(Ext.grid.HeaderDragZone,{constructor:function(d,c){Ext.grid.GridView.ColumnDragZone.superclass.constructor.call(this,d,c,null);this.proxy.el.addClass("x-grid3-col-dd")},handleMouseDown:function(b){},callHandleMouseDown:function(b){Ext.grid.GridView.ColumnDragZone.superclass.handleMouseDown.call(this,b)}});Ext.grid.SplitDragZone=Ext.extend(Ext.dd.DDProxy,{fly:Ext.Element.fly,constructor:function(e,f,d){this.grid=e;this.view=e.getView();this.proxy=this.view.resizeProxy;Ext.grid.SplitDragZone.superclass.constructor.call(this,f,"gridSplitters"+this.grid.getGridEl().id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.setHandleElId(Ext.id(f));this.setOuterHandleElId(Ext.id(d));this.scroll=false},b4StartDrag:function(f,g){this.view.headersDisabled=true;this.proxy.setHeight(this.view.mainWrap.getHeight());var e=this.cm.getColumnWidth(this.cellIndex);var h=Math.max(e-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(h,1000);this.setYConstraint(0,0);this.minX=f-h;this.maxX=f+1000;this.startPos=f;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,f,g)},handleMouseDown:function(f){var d=Ext.EventObject.setEvent(f);var e=this.fly(d.getTarget());if(e.hasClass("x-grid-split")){this.cellIndex=this.view.getCellIndex(e.dom);this.split=e.dom;this.cm=this.grid.colModel;if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){Ext.grid.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)}}},endDrag:function(f){this.view.headersDisabled=false;var e=Math.max(this.minX,Ext.lib.Event.getPageX(f));var d=e-this.startPos;this.view.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+d)},autoOffset:function(){this.setDelta(0,0)}});Ext.grid.GridDragZone=function(c,d){this.view=c.getView();Ext.grid.GridDragZone.superclass.constructor.call(this,this.view.mainBody.dom,d);this.scroll=false;this.grid=c;this.ddel=document.createElement("div");this.ddel.className="x-grid-dd-wrap"};Ext.extend(Ext.grid.GridDragZone,Ext.dd.DragZone,{ddGroup:"GridDD",getDragData:function(e){var f=Ext.lib.Event.getTarget(e);var g=this.view.findRowIndex(f);if(g!==false){var h=this.grid.selModel;if(!h.isSelected(g)||e.hasModifier()){h.handleMouseDown(this.grid,g,e)}return{grid:this.grid,ddel:this.ddel,rowIndex:g,selections:h.getSelections()}}return false},onInitDrag:function(c){var d=this.dragData;this.ddel.innerHTML=this.grid.getDragDropText();this.proxy.update(this.ddel)},afterRepair:function(){this.dragging=false},getRepairXY:function(c,d){return false},onEndDrag:function(d,c){},onValidDrop:function(e,d,f){this.hideProxy()},beforeInvalidDrop:function(d,c){}});Ext.grid.ColumnModel=Ext.extend(Ext.util.Observable,{defaultWidth:100,defaultSortable:false,constructor:function(b){if(b.columns){Ext.apply(this,b);this.setConfig(b.columns,true)}else{this.setConfig(b,true)}this.addEvents("widthchange","headerchange","hiddenchange","columnmoved","configchange");Ext.grid.ColumnModel.superclass.constructor.call(this)},getColumnId:function(b){return this.config[b].id},getColumnAt:function(b){return this.config[b]},setConfig:function(l,c){var k,i,h;if(!c){delete this.totalWidth;for(k=0,h=this.config.length;k<h;k++){i=this.config[k];if(i.setEditor){i.setEditor(null)}}}this.defaults=Ext.apply({width:this.defaultWidth,sortable:this.defaultSortable},this.defaults);this.config=l;this.lookup={};for(k=0,h=l.length;k<h;k++){i=Ext.applyIf(l[k],this.defaults);if(Ext.isEmpty(i.id)){i.id=k}if(!i.isColumn){var j=Ext.grid.Column.types[i.xtype||"gridcolumn"];i=new j(i);l[k]=i}this.lookup[i.id]=i}if(!c){this.fireEvent("configchange",this)}},getColumnById:function(b){return this.lookup[b]},getIndexById:function(f){for(var d=0,e=this.config.length;d<e;d++){if(this.config[d].id==f){return d}}return -1},moveColumn:function(g,c){var f=this.config,h=f[g];f.splice(g,1);f.splice(c,0,h);this.dataMap=null;this.fireEvent("columnmoved",this,g,c)},getColumnCount:function(c){var h=this.config.length,g=0,f;if(c===true){for(f=0;f<h;f++){if(!this.isHidden(f)){g++}}return g}return h},getColumnsBy:function(l,m){var c=this.config,k=c.length,i=[],n,j;for(n=0;n<k;n++){j=c[n];if(l.call(m||this,j,n)===true){i[i.length]=j}}return i},isSortable:function(b){return !!this.config[b].sortable},isMenuDisabled:function(b){return !!this.config[b].menuDisabled},getRenderer:function(b){return this.config[b].renderer||Ext.grid.ColumnModel.defaultRenderer},getRendererScope:function(b){return this.config[b].scope},setRenderer:function(d,c){this.config[d].renderer=c},getColumnWidth:function(d){var c=this.config[d].width;if(typeof c!="number"){c=this.defaultWidth}return c},setColumnWidth:function(d,f,e){this.config[d].width=f;this.totalWidth=null;if(!e){this.fireEvent("widthchange",this,d,f)}},getTotalWidth:function(d){if(!this.totalWidth){this.totalWidth=0;for(var f=0,e=this.config.length;f<e;f++){if(d||!this.isHidden(f)){this.totalWidth+=this.getColumnWidth(f)}}}return this.totalWidth},getColumnHeader:function(b){return this.config[b].header},setColumnHeader:function(d,c){this.config[d].header=c;this.fireEvent("headerchange",this,d,c)},getColumnTooltip:function(b){return this.config[b].tooltip},setColumnTooltip:function(d,c){this.config[d].tooltip=c},getDataIndex:function(b){return this.config[b].dataIndex},setDataIndex:function(d,c){this.config[d].dataIndex=c},findColumnIndex:function(h){var g=this.config;for(var c=0,f=g.length;c<f;c++){if(g[c].dataIndex==h){return c}}return -1},isCellEditable:function(c,g){var h=this.config[c],f=h.editable;return !!(f||(!Ext.isDefined(f)&&h.editor))},getCellEditor:function(d,c){return this.config[d].getCellEditor(c)},setEditable:function(d,c){this.config[d].editable=c},isHidden:function(b){return !!this.config[b].hidden},isFixed:function(b){return !!this.config[b].fixed},isResizable:function(b){return b>=0&&this.config[b].resizable!==false&&this.config[b].fixed!==true},setHidden:function(e,c){var f=this.config[e];if(f.hidden!==c){f.hidden=c;this.totalWidth=null;this.fireEvent("hiddenchange",this,e,c)}},setEditor:function(d,c){this.config[d].setEditor(c)},destroy:function(){var c=this.config.length,d=0;for(;d<c;d++){this.config[d].destroy()}delete this.config;delete this.lookup;this.purgeListeners()},setState:function(d,c){c=Ext.applyIf(c,this.defaults);Ext.apply(this.config[d],c)}});Ext.grid.ColumnModel.defaultRenderer=function(b){if(typeof b=="string"&&b.length<1){return"&#160;"}return b};Ext.grid.AbstractSelectionModel=Ext.extend(Ext.util.Observable,{constructor:function(){this.locked=false;Ext.grid.AbstractSelectionModel.superclass.constructor.call(this)},init:function(b){this.grid=b;if(this.lockOnInit){delete this.lockOnInit;this.locked=false;this.lock()}this.initEvents()},lock:function(){if(!this.locked){this.locked=true;var b=this.grid;if(b){b.getView().on({scope:this,beforerefresh:this.sortUnLock,refresh:this.sortLock})}else{this.lockOnInit=true}}},sortLock:function(){this.locked=true},sortUnLock:function(){this.locked=false},unlock:function(){if(this.locked){this.locked=false;var d=this.grid,c;if(d){c=d.getView();c.un("beforerefresh",this.sortUnLock,this);c.un("refresh",this.sortLock,this)}else{delete this.lockOnInit}}},isLocked:function(){return this.locked},destroy:function(){this.unlock();this.purgeListeners()}});Ext.grid.RowSelectionModel=Ext.extend(Ext.grid.AbstractSelectionModel,{singleSelect:false,constructor:function(b){Ext.apply(this,b);this.selections=new Ext.util.MixedCollection(false,function(a){return a.id});this.last=false;this.lastActive=false;this.addEvents("selectionchange","beforerowselect","rowselect","rowdeselect");Ext.grid.RowSelectionModel.superclass.constructor.call(this)},initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on("rowmousedown",this.handleMouseDown,this)}this.rowNav=new Ext.KeyNav(this.grid.getGridEl(),{up:this.onKeyPress,down:this.onKeyPress,scope:this});this.grid.getView().on({scope:this,refresh:this.onRefresh,rowupdated:this.onRowUpdated,rowremoved:this.onRemove})},onKeyPress:function(j,e){var h=e=="up",i=h?"selectPrevious":"selectNext",k=h?-1:1,l;if(!j.shiftKey||this.singleSelect){this[i](false)}else{if(this.last!==false&&this.lastActive!==false){l=this.last;this.selectRange(this.last,this.lastActive+k);this.grid.getView().focusRow(this.lastActive);if(l!==false){this.last=l}}else{this.selectFirstRow()}}},onRefresh:function(){var h=this.grid.store,i=this.getSelections(),j=0,g=i.length,f;this.silent=true;this.clearSelections(true);for(;j<g;j++){r=i[j];if((f=h.indexOfId(r.id))!=-1){this.selectRow(f,true)}}if(i.length!=this.selections.getCount()){this.fireEvent("selectionchange",this)}this.silent=false},onRemove:function(e,d,f){if(this.selections.remove(f)!==false){this.fireEvent("selectionchange",this)}},onRowUpdated:function(e,d,f){if(this.isSelected(f)){e.onRowSelect(d)}},selectRecords:function(f,h){if(!h){this.clearSelections()}var i=this.grid.store,j=0,g=f.length;for(;j<g;j++){this.selectRow(i.indexOf(f[j]),true)}},getCount:function(){return this.selections.length},selectFirstRow:function(){this.selectRow(0)},selectLastRow:function(b){this.selectRow(this.grid.store.getCount()-1,b)},selectNext:function(b){if(this.hasNext()){this.selectRow(this.last+1,b);this.grid.getView().focusRow(this.last);return true}return false},selectPrevious:function(b){if(this.hasPrevious()){this.selectRow(this.last-1,b);this.grid.getView().focusRow(this.last);return true}return false},hasNext:function(){return this.last!==false&&(this.last+1)<this.grid.store.getCount()},hasPrevious:function(){return !!this.last},getSelections:function(){return[].concat(this.selections.items)},getSelected:function(){return this.selections.itemAt(0)},each:function(h,i){var j=this.getSelections(),f=0,g=j.length;for(;f<g;f++){if(h.call(i||this,j[f],f)===false){return false}}return true},clearSelections:function(e){if(this.isLocked()){return}if(e!==true){var f=this.grid.store,d=this.selections;d.each(function(a){this.deselectRow(f.indexOfId(a.id))},this);d.clear()}else{this.selections.clear()}this.last=false},selectAll:function(){if(this.isLocked()){return}this.selections.clear();for(var c=0,d=this.grid.store.getCount();c<d;c++){this.selectRow(c,true)}},hasSelection:function(){return this.selections.length>0},isSelected:function(d){var c=Ext.isNumber(d)?this.grid.store.getAt(d):d;return(c&&this.selections.key(c.id)?true:false)},isIdSelected:function(b){return(this.selections.key(b)?true:false)},handleMouseDown:function(k,i,j){if(j.button!==0||this.isLocked()){return}var g=this.grid.getView();if(j.shiftKey&&!this.singleSelect&&this.last!==false){var l=this.last;this.selectRange(l,i,j.ctrlKey);this.last=l;g.focusRow(i)}else{var e=this.isSelected(i);if(j.ctrlKey&&e){this.deselectRow(i)}else{if(!e||this.getCount()>1){this.selectRow(i,j.ctrlKey||j.shiftKey);g.focusRow(i)}}}},selectRows:function(h,g){if(!g){this.clearSelections()}for(var e=0,f=h.length;e<f;e++){this.selectRow(h[e],true)}},selectRange:function(e,f,g){var h;if(this.isLocked()){return}if(!g){this.clearSelections()}if(e<=f){for(h=e;h<=f;h++){this.selectRow(h,true)}}else{for(h=e;h>=f;h--){this.selectRow(h,true)}}},deselectRange:function(h,e,f){if(this.isLocked()){return}for(var g=h;g<=e;g++){this.deselectRow(g,f)}},selectRow:function(e,g,f){if(this.isLocked()||(e<0||e>=this.grid.store.getCount())||(g&&this.isSelected(e))){return}var h=this.grid.store.getAt(e);if(h&&this.fireEvent("beforerowselect",this,e,g,h)!==false){if(!g||this.singleSelect){this.clearSelections()}this.selections.add(h);this.last=this.lastActive=e;if(!f){this.grid.getView().onRowSelect(e)}if(!this.silent){this.fireEvent("rowselect",this,e,h);this.fireEvent("selectionchange",this)}}},deselectRow:function(d,e){if(this.isLocked()){return}if(this.last==d){this.last=false}if(this.lastActive==d){this.lastActive=false}var f=this.grid.store.getAt(d);if(f){this.selections.remove(f);if(!e){this.grid.getView().onRowDeselect(d)}this.fireEvent("rowdeselect",this,d,f);this.fireEvent("selectionchange",this)}},acceptsNav:function(f,d,e){return !e.isHidden(d)&&e.isCellEditable(d,f)},onEditorKey:function(g,p){var u=p.getKey(),t,s=this.grid,c=s.lastEdit,q=s.activeEditor,v=p.shiftKey,e,c,w,k;if(u==p.TAB){p.stopEvent();q.completeEdit();if(v){t=s.walkCells(q.row,q.col-1,-1,this.acceptsNav,this)}else{t=s.walkCells(q.row,q.col+1,1,this.acceptsNav,this)}}else{if(u==p.ENTER){if(this.moveEditorOnEnter!==false){if(v){t=s.walkCells(c.row-1,c.col,-1,this.acceptsNav,this)}else{t=s.walkCells(c.row+1,c.col,1,this.acceptsNav,this)}}}}if(t){w=t[0];k=t[1];if(c.row!=w){this.selectRow(w)}if(s.isEditor&&s.editing){e=s.activeEditor;if(e&&e.field.triggerBlur){e.field.triggerBlur()}}s.startEditing(w,k)}},destroy:function(){Ext.destroy(this.rowNav);this.rowNav=null;Ext.grid.RowSelectionModel.superclass.destroy.call(this)}});Ext.grid.Column=Ext.extend(Ext.util.Observable,{isColumn:true,constructor:function(c){Ext.apply(this,c);if(Ext.isString(this.renderer)){this.renderer=Ext.util.Format[this.renderer]}else{if(Ext.isObject(this.renderer)){this.scope=this.renderer.scope;this.renderer=this.renderer.fn}}if(!this.scope){this.scope=this}var d=this.editor;delete this.editor;this.setEditor(d);this.addEvents("click","contextmenu","dblclick","mousedown");Ext.grid.Column.superclass.constructor.call(this)},processEvent:function(e,i,j,h,g){return this.fireEvent(e,this,j,h,i)},destroy:function(){if(this.setEditor){this.setEditor(null)}this.purgeListeners()},renderer:function(b){return b},getEditor:function(b){return this.editable!==false?this.editor:null},setEditor:function(c){var d=this.editor;if(d){if(d.gridEditor){d.gridEditor.destroy();delete d.gridEditor}else{d.destroy()}}this.editor=null;if(c){if(!c.isXType){c=Ext.create(c,"textfield")}this.editor=c}},getCellEditor:function(c){var d=this.getEditor(c);if(d){if(!d.startEdit){if(!d.gridEditor){d.gridEditor=new Ext.grid.GridEditor(d)}d=d.gridEditor}}return d}});Ext.grid.BooleanColumn=Ext.extend(Ext.grid.Column,{trueText:"true",falseText:"false",undefinedText:"&#160;",constructor:function(f){Ext.grid.BooleanColumn.superclass.constructor.call(this,f);var h=this.trueText,g=this.falseText,e=this.undefinedText;this.renderer=function(a){if(a===undefined){return e}if(!a||a==="false"){return g}return h}}});Ext.grid.NumberColumn=Ext.extend(Ext.grid.Column,{format:"0,000.00",constructor:function(b){Ext.grid.NumberColumn.superclass.constructor.call(this,b);this.renderer=Ext.util.Format.numberRenderer(this.format)}});Ext.grid.DateColumn=Ext.extend(Ext.grid.Column,{format:"m/d/Y",constructor:function(b){Ext.grid.DateColumn.superclass.constructor.call(this,b);this.renderer=Ext.util.Format.dateRenderer(this.format)}});Ext.grid.TemplateColumn=Ext.extend(Ext.grid.Column,{constructor:function(d){Ext.grid.TemplateColumn.superclass.constructor.call(this,d);var c=(!Ext.isPrimitive(this.tpl)&&this.tpl.compile)?this.tpl:new Ext.XTemplate(this.tpl);this.renderer=function(b,a,f){return c.apply(f.data)};this.tpl=c}});Ext.grid.ActionColumn=Ext.extend(Ext.grid.Column,{header:"&#160;",actionIdRe:/x-action-col-(\d+)/,altText:"",constructor:function(g){var i=this,l=g.items||(i.items=[i]),h=l.length,k,j;Ext.grid.ActionColumn.superclass.constructor.call(i,g);i.renderer=function(b,a){b=Ext.isFunction(g.renderer)?g.renderer.apply(this,arguments)||"":"";a.css+=" x-action-col-cell";for(k=0;k<h;k++){j=l[k];b+='<img alt="'+i.altText+'" src="'+(j.icon||Ext.BLANK_IMAGE_URL)+'" class="x-action-col-icon x-action-col-'+String(k)+" "+(j.iconCls||"")+" "+(Ext.isFunction(j.getClass)?j.getClass.apply(j.scope||this.scope||this,arguments):"")+'"'+((j.tooltip)?' ext:qtip="'+j.tooltip+'"':"")+" />"}return b}},destroy:function(){delete this.items;delete this.renderer;return Ext.grid.ActionColumn.superclass.destroy.apply(this,arguments)},processEvent:function(p,l,o,k,e){var j=l.getTarget().className.match(this.actionIdRe),m,n;if(j&&(m=this.items[parseInt(j[1],10)])){if(p=="click"){(n=m.handler||this.handler)&&n.call(m.scope||this.scope||this,o,k,e,m,l)}else{if((p=="mousedown")&&(m.stopSelection!==false)){return false}}}return Ext.grid.ActionColumn.superclass.processEvent.apply(this,arguments)}});Ext.grid.Column.types={gridcolumn:Ext.grid.Column,booleancolumn:Ext.grid.BooleanColumn,numbercolumn:Ext.grid.NumberColumn,datecolumn:Ext.grid.DateColumn,templatecolumn:Ext.grid.TemplateColumn,actioncolumn:Ext.grid.ActionColumn};Ext.grid.RowNumberer=Ext.extend(Object,{header:"",width:23,sortable:false,constructor:function(b){Ext.apply(this,b);if(this.rowspan){this.renderer=this.renderer.createDelegate(this)}},fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"numberer",rowspan:undefined,renderer:function(e,h,f,g){if(this.rowspan){h.cellAttr='rowspan="'+this.rowspan+'"'}return g+1}});Ext.grid.CheckboxSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,{header:'<div class="x-grid3-hd-checker">&#160;</div>',width:20,sortable:false,menuDisabled:true,fixed:true,hideable:false,dataIndex:"",id:"checker",isColumn:true,constructor:function(){Ext.grid.CheckboxSelectionModel.superclass.constructor.apply(this,arguments);if(this.checkOnly){this.handleMouseDown=Ext.emptyFn}},initEvents:function(){Ext.grid.CheckboxSelectionModel.superclass.initEvents.call(this);this.grid.on("render",function(){Ext.fly(this.grid.getView().innerHd).on("mousedown",this.onHdMouseDown,this)},this)},processEvent:function(e,i,j,h,g){if(e=="mousedown"){this.onMouseDown(i,i.getTarget());return false}else{return Ext.grid.Column.prototype.processEvent.apply(this,arguments)}},onMouseDown:function(h,e){if(h.button===0&&e.className=="x-grid3-row-checker"){h.stopEvent();var g=h.getTarget(".x-grid3-row");if(g){var f=g.rowIndex;if(this.isSelected(f)){this.deselectRow(f)}else{this.selectRow(f,true);this.grid.getView().focusRow(f)}}}},onHdMouseDown:function(h,f){if(f.className=="x-grid3-hd-checker"){h.stopEvent();var e=Ext.fly(f.parentNode);var g=e.hasClass("x-grid3-hd-checker-on");if(g){e.removeClass("x-grid3-hd-checker-on");this.clearSelections()}else{e.addClass("x-grid3-hd-checker-on");this.selectAll()}}},renderer:function(d,f,e){return'<div class="x-grid3-row-checker">&#160;</div>'}});